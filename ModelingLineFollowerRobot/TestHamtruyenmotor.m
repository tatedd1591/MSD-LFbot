%% ------------------------------------------------------------------- %%
%%  Mo phong Robot do line - Do an thiet ke He thong Co dien tu ME4071 %%
%%                     Truong Dai hoc Bach Khoa                        %%
%%                           Khoa Co khi                               %%
%%                           ---***---                                 %%
%%               KIEM TRA HAM TRUYEN DONG CO                           %%
%|               GVHD: Nguyen Tan Tien - Duong Van Tu                  |%
%|                                                                     |%
%|               SVTH: Huynh Nguyen Phong - 1914622                    |%
%|               Gmail: phong.huynhnguyen2401@hcmut.edu.vn             |%
%% ------------------------------------------------------------------- %%
%% Click Run to RUN %%
clc
clear all
close all
%% %PWM
IN=[
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
100
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
200
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
300
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
400
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
500
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
600
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
700
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
800
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
900
]*0.1
;
%% Dong co 1
OUT1= [	
0
0
11.46497
15.28662
19.10828
15.28662
19.10828
19.10828
19.10828
19.10828
22.92994
19.10828
19.10828
22.92994
19.10828
19.10828
22.92994
22.92994
15.28662
22.92994
22.92994
22.92994
30.57325
38.21656
38.21656
38.21656
45.85988
42.03822
42.03822
42.03822
42.03822
45.85988
45.85988
42.03822
42.03822
45.85988
42.03822
45.85988
42.03822
45.85988
45.85988
45.85988
53.50319
61.1465
61.1465
61.1465
64.96816
64.96816
68.78981
68.78981
64.96816
68.78981
64.96816
68.78981
68.78981
64.96816
68.78981
64.96816
68.78981
68.78981
64.96816
72.61147
76.43312
80.25478
84.07643
87.89809
87.89809
87.89809
91.71975
87.89809
91.71975
87.89809
91.71975
91.71975
91.71975
87.89809
91.71975
91.71975
87.89809
91.71975
91.71975
95.54141
103.1847
103.1847
107.0064
107.0064
110.828
110.828
114.6497
110.828
114.6497
114.6497
110.828
118.4713
110.828
114.6497
114.6497
114.6497
114.6497
114.6497
114.6497
118.4713
122.293
122.293
129.9363
129.9363
137.5796
133.758
133.758
137.5796
133.758
137.5796
133.758
137.5796
137.5796
137.5796
137.5796
137.5796
137.5796
141.4013
141.4013
145.2229
145.2229
149.0446
152.8662
156.6879
156.6879
156.6879
156.6879
156.6879
160.5096
160.5096
160.5096
156.6879
164.3312
160.5096
160.5096
160.5096
160.5096
160.5096
160.5096
168.1529
168.1529
168.1529
175.7962
175.7962
175.7962
179.6178
179.6178
183.4395
179.6178
183.4395
183.4395
179.6178
187.2612
183.4395
183.4395
183.4395
183.4395
183.4395
183.4395
187.2612
191.0828
191.0828
198.7261
198.7261
198.7261
202.5478
202.5478
202.5478
202.5478
206.3694
206.3694
206.3694
206.3694
206.3694
206.3694
210.1911
206.3694
206.3694
210.1911
183.4395
129.9363
95.54141
68.78981
49.68153
38.21656
30.57325
26.75159
22.92994
22.92994
22.92994
19.10828
22.92994
22.92994
19.10828
19.10828
22.92994
19.10828
22.92994
19.10828
22.92994
34.39491
34.39491
38.21656
42.03822
42.03822
42.03822
45.85988
42.03822
42.03822
45.85988
42.03822
45.85988
45.85988
42.03822
45.85988
42.03822
45.85988
42.03822
45.85988
49.68153
53.50319
61.1465
61.1465
61.1465
64.96816
64.96816
68.78981
64.96816
68.78981
64.96816
68.78981
68.78981
64.96816
68.78981
68.78981
68.78981
64.96816
68.78981
68.78981
68.78981
80.25478
80.25478
84.07643
87.89809
87.89809
91.71975
87.89809
91.71975
87.89809
91.71975
91.71975
91.71975
87.89809
91.71975
91.71975
91.71975
91.71975
91.71975
91.71975
95.54141
99.36306
107.0064
107.0064
107.0064
110.828
114.6497
110.828
114.6497
114.6497
114.6497
114.6497
110.828
118.4713
110.828
114.6497
114.6497
114.6497
114.6497
114.6497
118.4713
122.293
126.1147
129.9363
133.758
129.9363
133.758
133.758
137.5796
137.5796
137.5796
137.5796
137.5796
137.5796
141.4013
141.4013
137.5796
145.2229
137.5796
141.4013
141.4013
145.2229
152.8662
152.8662
152.8662
152.8662
160.5096
156.6879
156.6879
160.5096
160.5096
160.5096
160.5096
160.5096
160.5096
160.5096
160.5096
160.5096
160.5096
164.3312
164.3312
168.1529
168.1529
175.7962
175.7962
179.6178
179.6178
179.6178
183.4395
179.6178
183.4395
183.4395
187.2612
183.4395
183.4395
183.4395
187.2612
183.4395
183.4395
187.2612
187.2612
191.0828
191.0828
198.7261
198.7261
202.5478
202.5478
198.7261
206.3694
206.3694
202.5478
206.3694
206.3694
206.3694
206.3694
210.1911
206.3694
206.3694
210.1911
];
%% Dong co 2
OUT2=[	
0
7.643312
7.643312
15.28662
19.10828
19.10828
15.28662
22.92994
22.92994
15.28662
22.92994
22.92994
19.10828
19.10828
22.92994
19.10828
22.92994
19.10828
22.92994
22.92994
15.28662
30.57325
30.57325
38.21656
38.21656
42.03822
42.03822
45.85988
42.03822
45.85988
42.03822
45.85988
45.85988
45.85988
45.85988
45.85988
42.03822
45.85988
42.03822
45.85988
45.85988
49.68153
57.32484
57.32484
64.96816
64.96816
64.96816
68.78981
68.78981
68.78981
68.78981
68.78981
68.78981
68.78981
68.78981
68.78981
68.78981
72.61147
68.78981
72.61147
68.78981
68.78981
84.07643
84.07643
84.07643
91.71975
91.71975
91.71975
91.71975
91.71975
91.71975
91.71975
91.71975
95.54141
95.54141
91.71975
91.71975
95.54141
91.71975
95.54141
91.71975
99.36306
99.36306
107.0064
110.828
110.828
114.6497
114.6497
114.6497
114.6497
122.293
114.6497
114.6497
122.293
114.6497
118.4713
118.4713
114.6497
118.4713
118.4713
118.4713
118.4713
129.9363
126.1147
133.758
137.5796
137.5796
137.5796
137.5796
137.5796
137.5796
141.4013
141.4013
137.5796
145.2229
137.5796
137.5796
141.4013
141.4013
137.5796
141.4013
141.4013
149.0446
152.8662
156.6879
156.6879
160.5096
160.5096
164.3312
160.5096
168.1529
160.5096
168.1529
164.3312
164.3312
168.1529
160.5096
168.1529
168.1529
168.1529
164.3312
168.1529
171.9745
175.7962
179.6178
183.4395
183.4395
183.4395
187.2612
187.2612
187.2612
187.2612
191.0828
187.2612
191.0828
187.2612
187.2612
191.0828
191.0828
191.0828
191.0828
191.0828
198.7261
198.7261
206.3694
202.5478
210.1911
206.3694
206.3694
214.0127
206.3694
214.0127
214.0127
210.1911
214.0127
214.0127
210.1911
214.0127
217.8344
214.0127
214.0127
191.0828
133.758
99.36306
64.96816
49.68153
38.21656
30.57325
22.92994
22.92994
22.92994
22.92994
22.92994
22.92994
19.10828
22.92994
19.10828
22.92994
22.92994
19.10828
19.10828
26.75159
34.39491
38.21656
38.21656
42.03822
42.03822
45.85988
45.85988
45.85988
45.85988
42.03822
45.85988
42.03822
45.85988
45.85988
45.85988
45.85988
45.85988
45.85988
45.85988
45.85988
57.32484
61.1465
64.96816
68.78981
64.96816
68.78981
64.96816
72.61147
64.96816
72.61147
68.78981
72.61147
64.96816
72.61147
68.78981
68.78981
68.78981
68.78981
68.78981
76.43312
80.25478
84.07643
87.89809
91.71975
87.89809
91.71975
91.71975
91.71975
95.54141
91.71975
91.71975
95.54141
95.54141
91.71975
91.71975
95.54141
95.54141
91.71975
91.71975
95.54141
103.1847
107.0064
110.828
110.828
114.6497
114.6497
114.6497
118.4713
118.4713
114.6497
118.4713
118.4713
118.4713
118.4713
118.4713
118.4713
114.6497
122.293
114.6497
122.293
126.1147
129.9363
133.758
137.5796
137.5796
137.5796
137.5796
137.5796
141.4013
141.4013
141.4013
141.4013
137.5796
137.5796
141.4013
141.4013
137.5796
141.4013
141.4013
141.4013
149.0446
152.8662
152.8662
160.5096
160.5096
160.5096
160.5096
168.1529
160.5096
168.1529
160.5096
168.1529
168.1529
164.3312
164.3312
168.1529
164.3312
164.3312
168.1529
168.1529
175.7962
175.7962
183.4395
183.4395
183.4395
183.4395
187.2612
187.2612
187.2612
187.2612
187.2612
187.2612
191.0828
187.2612
191.0828
191.0828
191.0828
187.2612
191.0828
194.9045
194.9045
198.7261
206.3694
206.3694
206.3694
210.1911
210.1911
214.0127
210.1911
210.1911
214.0127
214.0127
214.0127
214.0127
214.0127
214.0127
214.0127
214.0127
];
global PWMLe PWMRi
PWMLe=0;
PWMRi=0;
pre_nRi=0;
pre_nLe=0;
%% --- %%
for j=2:360
    if j==2
        PWMRi = PWMRi + 10;
        PWMLe = PWMLe + 10;
    end
    if j == 21
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 41
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 61
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 81
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 101
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 121
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 141
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 161
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 181
        PWMRi = 10; PWMLe = 10;
    end
    if j == 201
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 221
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 241
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 261
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 281
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 301
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 321
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    if j == 341
        PWMRi = PWMRi + 10; PWMLe = PWMLe + 10;
    end
    [tt,y1] = ode45(@motorRi_tf, [0 0.01], pre_nRi);
    pre_nRi = y1(length(y1),1);
    wRi(j)  = pre_nRi;
    
    [tt,y2] = ode45(@motorLe_tf,[0 0.01],pre_nLe);
    pre_nLe = y2(length(y2),1);
    wLe(j)  = pre_nLe;
end 
%% --- %%
%% Ve duong dap ung tu ham truyen mo phong va thuc te
%% Dong co 1
plot(IN,'Linewidth',2);
hold on
plot(OUT1,'b');
plot(wRi,'black','Linewidth',1);
legend('%PWM','wRi thuc te','wRi tinh toan');
xlabel('time(10^-^2s)');
ylabel('RPM');
xlim([0,365]);
ylim([0,250]);
title('Duong dap ung cua ham truyen dong co 1 (ti le fit: 94.63%)');
%% Dong co 2
figure();
plot(IN,'Linewidth',2);
hold on;
plot(OUT2,'r');
plot(wLe,'black','Linewidth',1);
legend('%PWM','wLe thuc te','wLe tinh toan');
xlabel('time(10^-^2s)');
ylabel('RPM');
xlim([0,365]);
ylim([0,250]);
title('Duong dap ung cua dong co 2 (ti le fit: 94.19%)');
%% Duong dap ung toc do thuc te
% plot(IN,'Linewidth',2);
% hold on
% plot(OUT1,'b');
% % plot(wRi,'black');
% legend('%PWM','wRi thuc te');
% xlabel('time(10^-^2s)');
% ylabel('RPM');
% xlim([0,365]);
% ylim([0,250]);
% title('Duong dap ung toc do cua dong co 1 tu thuc te');
% % hold on
% figure();
% 
% plot(IN,'Linewidth',2);
% hold on;
% plot(OUT2,'r');
% % plot(wLe,'black');
% legend('%PWM','wLe thuc te');
% xlabel('time(10^-^2s)');
% ylabel('RPM');
%   xlim([0,365]);
%   ylim([0,250]);
%   title('Duong dap ung toc cua dong co 2 tu thuc te');